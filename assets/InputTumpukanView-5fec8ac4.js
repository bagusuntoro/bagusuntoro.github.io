import{r as P,i as G,o as l,c as i,j as v,z as $,a as t,t as r,w as T,G as N,F as p,D as g,n as w,q as I,B as A,s as O,E as V}from"./index-d101573f.js";import{S as j,N as U}from"./Navbar-fe6fe40f.js";import{C as H}from"./ChatMe-ce333ade.js";const J={id:"wrapper"},F={id:"content-wrapper",class:"d-flex flex-column"},E={id:"content"},L=t("h1",{class:"h3 mb-0 text-gray-800 text-center mt-4"},"Halaman Input Tumpukan",-1),q={class:"row mt-5"},z=t("div",{class:"col-1"},null,-1),K={class:"col-10"},M={class:"row"},W=t("div",{class:"col-4"},[t("h6",null,"Lokasi")],-1),Q={class:"col-8"},R={class:"row"},X=t("div",{class:"col-4"},[t("h6",null,"Tanggal")],-1),Y={class:"col-8"},Z={class:"row"},x=t("div",{class:"col-4"},[t("h6",null,"Supir")],-1),tt={class:"col-8"},st={class:"row"},et=t("div",{class:"col-4"},[t("h6",null,"No. Container")],-1),at={class:"col-8"},ot={class:"row"},nt=t("div",{class:"col-4"},[t("h6",null,"No Telp")],-1),lt={class:"col-8"},it={class:"row"},rt=t("div",{class:"col-4"},[t("h6",null,"No Seal")],-1),dt={class:"col-8"},ut={class:"row"},ct=t("div",{class:"col-4"},[t("h6",null,"Tujuan")],-1),ht={class:"col-8"},_t=t("div",{class:"col-1"},null,-1),pt={class:"row mt-4"},gt=t("div",{class:"col-1"},null,-1),mt={class:"col-10"},kt={class:"row"},vt={class:"col-sm-6"},bt=t("label",{for:"barang",class:"form-label"},"SPPG",-1),ft=t("option",{disabled:""},"Pilih SPPG",-1),wt=["value"],Bt={key:0,class:"col-sm-6"},St=t("label",{for:"barang",class:"form-label"},"Barang",-1),Pt={class:"row"},Tt={class:"col-9"},Nt=t("option",{disabled:""},"Pilih barang",-1),It=["value"],yt={class:"col-3"},Ct=t("i",{class:"bi bi-check2-circle"},null,-1),Dt=[Ct],Gt={class:"row"},$t={key:0,class:"col-sm-6"},At=t("label",{for:"tumpukan",class:"form-label"},"Tumpukan",-1),Ot={class:"row ms-1"},Vt={class:"col-6"},jt={class:"row"},Ut={class:"col-8 border bg-white"},Ht={class:"col-4"},Jt=t("i",{class:"bi bi-plus"},null,-1),Ft=[Jt],Et={class:"col-3"},Lt=t("i",{class:"bi bi-arrow-down-square"},null,-1),qt=[Lt],zt=t("div",{class:"col-3"},null,-1),Kt={class:"col-sm-6"},Mt=t("i",{class:"bi bi-arrow-down-circle"},null,-1),Wt=t("h4",{class:"text-center mt-5 mb-3"},"Data Barang",-1),Qt={class:"table-responsive"},Rt={class:"bordered-table table-striped m-auto"},Xt=t("th",null,"No. SPPG",-1),Yt=t("th",null,"Jenis Barang",-1),Zt=t("th",null,"Total",-1),xt=t("div",{class:"col-1"},null,-1),ts={class:"row"},ss=t("div",{class:"col-1"},null,-1),es={class:"col-10"},as={class:"row mb-5 mt-5"},os={class:"col-6"},ns={class:"col-6"},ls=t("div",{class:"col-1"},null,-1),is={data(){return{tumpukan:0,selectedBarang:null,listBarang:[],dataBarang:[],headers:[],APIHeaders:[],detailNote:[],role:null,id_note:null,selectedSPPG:null,showInput:!1,showBarang:!1}},methods:{realtimeInput(){console.log("test :",this.dataBarang);const n=[];this.dataBarang.forEach(d=>{const u={};for(const c in d.tumpukan)u[`tumpukan_${c}`]=d.tumpukan[c].join(",");const s=this.getTotalTumpukan(d),o={...u,barang:d.barang,sppg:d.sppg,id_note:0,total:s};n.push(o)});const a=JSON.stringify(this.dataBarang);n.length===0&&this.showAlert(),localStorage.setItem("tumpukans",a)},submitData(){this.realtimeInput(),this.showInput=!1,this.$router.push({name:"user-signature"})},showAlert(){this.$swal("SPPG tidak tersedia!!").then(()=>{this.$router.push("/user-input-note")})},fetchBarang(){let n=new FormData;n.append("lokasi",this.APIHeaders.lokasi),n.append("id_keterangan",this.APIHeaders.id_keterangan),O.post("https://10.11.10.243/backend/public/api/sppg",n).then(a=>{this.listBarang=a.data.data}).catch(a=>{console.error(a),this.showAlert()})},submitBarang(){this.selectedBarang&&(this.dataBarang.push({barang:this.selectedBarang,sppg:this.selectedSPPG,tumpukan:{}}),this.showBarang=!1),this.showInput=!0},hitungTumpukan(){this.tumpukan=parseInt(this.tumpukan+1)},submitTumpukan(){if(this.tumpukan&&this.dataBarang.length>0){const n=this.dataBarang[this.dataBarang.length-1],a=Object.keys(n.tumpukan).length+1;console.log("test header: ",a),console.log("test lastBarang: ",n),a<=10&&(this.headers.includes(a.toString())||(this.headers.push(a.toString()),console.log("test headers: ",this.headers)),n.tumpukan[a.toString()]||(n.tumpukan[a.toString()]=[],console.log("test lastBarang: ",n)),n.tumpukan[a.toString()].push(parseInt(this.tumpukan))),this.tumpukan=0}this.realtimeInput()},getTotalTumpukan(n){let a=0;for(const d in n.tumpukan)for(const u of n.tumpukan[d])a+=u;return a}},created(){const n=new Date().toUTCString();console.log("Waktu Sekarang (UTC):",n);const a=sessionStorage.getItem("token");if(a)try{const[d,u]=a.split("."),s=JSON.parse(atob(d)),o=atob(u),c=JSON.parse(atob(a.split(".")[1])),e=c.exp,b=new Date(e*1e3);console.log("Waktu Kedaluwarsa (UTC):",b.toUTCString()),new Date>b?(console.log("Keluar"),sessionStorage.removeItem("token"),this.$router.push("/")):console.log("Aman"),this.role=c.role,this.APIHeaders.lokasi=c.kodeLokasi,this.role!=="user"?this.$router.push("/unauthorized"):(!s||!o)&&this.$router.push("/");const _=localStorage.getItem("note");_&&(this.detailNote=_,this.detailNote=JSON.parse(_),this.APIHeaders.id_keterangan=this.detailNote.id_keterangan);const m=localStorage.getItem("tumpukans");if(m){const k=JSON.parse(m);this.dataBarang=k,console.log("test data tumpukan: ",k[0].sppg);let f=0;for(let h=0;h<k.length;h++){const S=k[h].tumpukan,y=Object.keys(S).reduce((C,D)=>C+S[D].length,0);f=Math.max(f,y)}for(let h=0;h<f;h++)this.headers[h]=(h+1).toString();console.log(" header: ",f),console.log("test headers: ",this.headers),console.log("from data: ",k[0].tumpukan),console.log("form ls: ",this.dataBarang),this.showInput=!0;const B=this.dataBarang.length-1;this.selectedSPPG=this.dataBarang[B].sppg,this.selectedBarang=this.dataBarang[B].barang}this.fetchBarang()}catch(d){console.error("Error decoding token:",d),this.$router.push("/")}else this.$router.push("/")}},cs=Object.assign(is,{__name:"InputTumpukanView",setup(n){const a=P(!1),d=P(""),u=()=>{a.value=!a.value,d.value=a.value?"toggle-sidebar":""};return(s,o)=>{const c=G("router-link");return l(),i("div",J,[v(j,{class:$(d.value)},null,8,["class"]),t("div",F,[t("div",E,[v(U,{onToggleSidebar:u}),v(H),L,t("div",q,[z,t("div",K,[t("div",M,[W,t("div",Q,[t("h6",null,": "+r(this.detailNote.location),1)])]),t("div",R,[X,t("div",Y,[t("h6",null,": "+r(this.detailNote.date),1)])]),t("div",Z,[x,t("div",tt,[t("h6",null,": "+r(this.detailNote.driver),1)])]),t("div",st,[et,t("div",at,[t("h6",null,": "+r(this.detailNote.no_container),1)])]),t("div",ot,[nt,t("div",lt,[t("h6",null,": "+r(this.detailNote.telp),1)])]),t("div",it,[rt,t("div",dt,[t("h6",null,": "+r(this.detailNote.no_seal),1)])]),t("div",ut,[ct,t("div",ht,[t("h6",null,": "+r(this.detailNote.destination),1)])])]),_t]),t("div",pt,[gt,t("div",mt,[t("div",kt,[t("div",vt,[bt,T(t("select",{"onUpdate:modelValue":o[0]||(o[0]=e=>s.selectedSPPG=e),class:"form-select","aria-label":"Default select example",onSelect:o[1]||(o[1]=e=>s.showBarang=!0)},[ft,(l(!0),i(p,null,g(s.listBarang,e=>(l(),i("option",{key:e.id,value:e.no_sppg},r(e.no_sppg),9,wt))),128))],544),[[N,s.selectedSPPG]])]),s.selectedSPPG!=null?(l(),i("div",Bt,[St,t("div",Pt,[t("div",Tt,[T(t("select",{"onUpdate:modelValue":o[2]||(o[2]=e=>s.selectedBarang=e),class:"form-select","aria-label":"Default select example"},[Nt,(l(!0),i(p,null,g(s.listBarang,e=>(l(),i("option",{key:e.id,value:e.product_name},r(e.product_name),9,It))),128))],512),[[N,s.selectedBarang]])]),t("div",yt,[s.selectedBarang!=null?(l(),i("button",{key:0,onClick:o[3]||(o[3]=(...e)=>s.submitBarang&&s.submitBarang(...e)),class:"btn btn-success"},Dt)):w("",!0)])])])):w("",!0)]),t("div",Gt,[s.showInput===!0?(l(),i("div",$t,[At,t("div",Ot,[t("div",Vt,[t("div",jt,[t("div",Ut,[t("h4",null,r(this.tumpukan),1)]),t("div",Ht,[t("button",{onClick:o[4]||(o[4]=e=>s.hitungTumpukan()),class:"btn btn-danger"},Ft)])])]),t("div",Et,[s.tumpukan!=0?(l(),i("button",{key:0,onClick:o[5]||(o[5]=(...e)=>s.submitTumpukan&&s.submitTumpukan(...e)),class:"btn btn-success ms-3"},qt)):w("",!0)]),zt])])):w("",!0),t("div",Kt,[t("button",{onClick:o[6]||(o[6]=e=>(s.selectedBarang=null,s.selectedSPPG=null,s.showInput=!1,s.tumpukan=0)),class:"btn btn-warning w-100 customNext"},[I(" Baris Baru "),Mt])])]),Wt,t("div",Qt,[t("table",Rt,[t("thead",null,[t("tr",null,[Xt,Yt,(l(!0),i(p,null,g(s.headers,e=>(l(),i("th",{key:e,class:"text-center"},r(e),1))),128)),Zt])]),t("tbody",null,[(l(!0),i(p,null,g(s.dataBarang,(e,b)=>(l(),i("tr",{key:b},[t("td",null,r(e.sppg),1),t("td",null,r(e.barang),1),(l(!0),i(p,null,g(s.headers,_=>(l(),i("td",{key:_},[(l(!0),i(p,null,g(e.tumpukan[_],m=>(l(),i("p",{key:m},r(m),1))),128))]))),128)),t("td",null,r(s.getTotalTumpukan(e)),1)]))),128))])])])]),xt]),t("div",ts,[ss,t("div",es,[t("div",as,[t("div",os,[v(c,{to:"/user-input-note",class:"btn btn-danger"},{default:A(()=>[I(" Kembali ")]),_:1})]),t("div",ns,[t("button",{class:"btn blueButton float-end",onClick:o[7]||(o[7]=(...e)=>s.submitData&&s.submitData(...e))}," Selanjutnya ")])])]),ls])]),v(V)])])}}});export{cs as default};
